<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HD Camera 60FPS with On/Off Control</title>
  <style>
    :root {
      --primary-color: #4caf50;
      --secondary-color: #2196f3;
      --danger-color: #f44336;
      --dark-bg: #121212;
      --card-bg: #1f1f1f;
      --text-color: #ffffff;
      --border-radius: 10px;
    }
    
    body {
      background: var(--dark-bg);
      color: var(--text-color);
      font-family: 'Segoe UI', Roboto, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      padding: 20px;
      margin: 0;
    }
    
    h1 {
      margin: 0.5em 0;
      text-align: center;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 800px;
    }
    
    .camera-container {
      position: relative;
      width: 90%;
      max-width: 600px;
      margin-bottom: 15px;
    }
    
    video {
      width: 100%;
      background: black;
      border-radius: var(--border-radius);
      object-fit: contain;
      display: block;
    }
    
    .camera-off {
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      color: white;
      font-size: 1.2em;
    }
    
    .fps-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      z-index: 10;
    }
    
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      width: 100%;
      margin-bottom: 15px;
    }
    
    .control-group {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 15px;
      width: 100%;
      max-width: 600px;
    }
    
    .btn {
      padding: 10px 15px;
      margin: 5px;
      border: none;
      background-color: var(--card-bg);
      color: white;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
    }
    
    .btn-primary {
      background-color: var(--primary-color);
    }
    
    .btn-danger {
      background-color: var(--danger-color);
    }
    
    .btn-secondary {
      background-color: var(--secondary-color);
    }
    
    #status {
      font-weight: bold;
      margin: 10px 0;
      padding: 8px 15px;
      border-radius: 20px;
      background-color: rgba(0,0,0,0.3);
    }
    
    #downloadLink {
      display: none;
      margin: 10px 0;
    }
    
    #recordedPreview {
      width: 100%;
      max-width: 600px;
      border-radius: var(--border-radius);
      background: black;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>HD Camera with On/Off Control</h1>
    
    <div class="camera-container">
      <video id="preview" autoplay muted playsinline></video>
      <div id="cameraOffMessage" class="camera-off" style="display:none; height: 337px;">
        Camera is currently turned off
      </div>
      <div class="fps-indicator" id="fpsIndicator">FPS: --</div>
    </div>
    
    <div id="status">Status: Initializing...</div>
    
    <div class="controls">
      <div class="control-group">
        <h3>Camera Controls</h3>
        <button id="toggleCameraBtn" class="btn btn-primary">Turn Camera Off</button>
        <button id="flipCamBtn" class="btn">Switch Camera</button>
        <button id="60fpsBtn" class="btn btn-secondary">Enable 60FPS</button>
      </div>
      
      <div class="control-group">
        <h3>Recording Settings</h3>
        <button id="startBtn" class="btn btn-primary">Start Recording</button>
        <button id="stopBtn" class="btn btn-danger" disabled>Stop</button>
        <div>Resolution: 
          <select id="resolutionSelect" class="btn">
            <option value="480p">480p (640×480)</option>
            <option value="720p">HD (1280×720)</option>
            <option value="1080p" selected>Full HD (1920×1080)</option>
          </select>
        </div>
      </div>
    </div>
    
    <a id="downloadLink" class="btn btn-secondary" download="recording.mp4">Download Recording</a>
    
    <div>
      <h3>Preview:</h3>
      <video id="recordedPreview" controls style="display:none;"></video>
    </div>
  </div>

  <script>
    // Main variables
    let mediaRecorder;
    let recordedBlobs = [];
    let videoTrack;
    let stream = null;
    let usingFrontCamera = true;
    let prefer60fps = false;
    let isCameraOn = true;
    let fpsInterval;
    let lastFrameTime = 0;
    let frameCount = 0;
    let currentFps = 0;

    // DOM elements
    const preview = document.getElementById('preview');
    const cameraOffMessage = document.getElementById('cameraOffMessage');
    const fpsIndicator = document.getElementById('fpsIndicator');
    const toggleCameraBtn = document.getElementById('toggleCameraBtn');
    const downloadLink = document.getElementById('downloadLink');
    const statusText = document.getElementById('status');
    const recordedPreview = document.getElementById('recordedPreview');

    // FPS counter
    function checkFPS() {
      if (!isCameraOn) return;
      
      const now = performance.now();
      if (lastFrameTime) {
        frameCount++;
        if (now - lastFrameTime >= 1000) {
          currentFps = Math.round((frameCount * 1000) / (now - lastFrameTime));
          fpsIndicator.textContent = `FPS: ${currentFps}`;
          frameCount = 0;
          lastFrameTime = now;
          
          if (prefer60fps && currentFps < 50) {
            statusText.textContent = `Status: ${currentFps}FPS (aiming for 60FPS)`;
          }
        }
      } else {
        lastFrameTime = now;
      }
      requestAnimationFrame(checkFPS);
    }

    // Start camera
    async function startCamera() {
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        stream = null;
      }

      const resolution = document.getElementById('resolutionSelect').value;
      let width, height;
      
      switch(resolution) {
        case '480p': width = 640; height = 480; break;
        case '720p': width = 1280; height = 720; break;
        case '1080p': width = 1920; height = 1080; break;
        default: width = 1920; height = 1080;
      }

      const constraints = {
        audio: true,
        video: {
          facingMode: usingFrontCamera ? 'user' : 'environment',
          width: { ideal: width },
          height: { ideal: height },
          frameRate: { 
            ideal: prefer60fps ? 60 : 30,
            max: prefer60fps ? 60 : 30
          }
        }
      };

      try {
        statusText.textContent = 'Status: Starting camera...';
        stream = await navigator.mediaDevices.getUserMedia(constraints);
        preview.srcObject = stream;
        videoTrack = stream.getVideoTracks()[0];
        
        lastFrameTime = 0;
        frameCount = 0;
        checkFPS();
        
        isCameraOn = true;
        preview.style.display = 'block';
        cameraOffMessage.style.display = 'none';
        toggleCameraBtn.textContent = 'Turn Camera Off';
        statusText.textContent = `Status: Camera on (${prefer60fps ? '60FPS' : '30FPS'})`;
        
        // Enable recording buttons
        document.getElementById('startBtn').disabled = false;
      } catch (err) {
        console.error('Camera error:', err);
        
        if (prefer60fps) {
          prefer60fps = false;
          statusText.textContent = 'Status: Falling back to 30FPS';
          startCamera();
        } else {
          isCameraOn = false;
          preview.style.display = 'none';
          cameraOffMessage.style.display = 'flex';
          toggleCameraBtn.textContent = 'Turn Camera On';
          statusText.textContent = 'Status: Camera error - ' + err.message;
        }
      }
    }

    // Stop camera
    function stopCamera() {
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        stream = null;
      }
      
      isCameraOn = false;
      preview.style.display = 'none';
      cameraOffMessage.style.display = 'flex';
      toggleCameraBtn.textContent = 'Turn Camera On';
      fpsIndicator.textContent = 'FPS: --';
      statusText.textContent = 'Status: Camera off';
      
      // Disable recording buttons
      document.getElementById('startBtn').disabled = true;
      document.getElementById('stopBtn').disabled = true;
    }

    // Toggle camera on/off
    function toggleCamera() {
      if (isCameraOn) {
        stopCamera();
      } else {
        startCamera();
      }
    }

    // Start recording
    function startRecording() {
      if (!isCameraOn) return;
      
      recordedBlobs = [];
      const codecPreferences = [
        'video/webm;codecs=vp9,opus',
        'video/webm;codecs=vp8,opus',
        'video/webm'
      ];
      
      let options;
      for (const codec of codecPreferences) {
        if (MediaRecorder.isTypeSupported(codec)) {
          options = { mimeType: codec };
          break;
        }
      }
      
      try {
        mediaRecorder = new MediaRecorder(stream, options || { mimeType: 'video/webm' });
        
        mediaRecorder.ondataavailable = e => {
          if (e.data.size > 0) recordedBlobs.push(e.data);
        };
        
        mediaRecorder.onstop = () => {
          const blob = new Blob(recordedBlobs, { type: recordedBlobs[0].type });
          const url = URL.createObjectURL(blob);
          downloadLink.href = url;
          downloadLink.style.display = 'inline-block';
          recordedPreview.src = url;
          recordedPreview.style.display = 'block';
          statusText.textContent = 'Status: Recording saved';
        };
        
        mediaRecorder.start(100);
        statusText.textContent = `Status: Recording at ${currentFps}FPS...`;
        document.getElementById('startBtn').disabled = true;
        document.getElementById('stopBtn').disabled = false;
        
      } catch (err) {
        statusText.textContent = 'Status: Recording failed - ' + err.message;
      }
    }

    // Stop recording
    function stopRecording() {
      if (mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
        document.getElementById('startBtn').disabled = !isCameraOn;
        document.getElementById('stopBtn').disabled = true;
      }
    }

    // Event listeners
    document.getElementById('startBtn').addEventListener('click', startRecording);
    document.getElementById('stopBtn').addEventListener('click', stopRecording);
    document.getElementById('toggleCameraBtn').addEventListener('click', toggleCamera);
    document.getElementById('flipCamBtn').addEventListener('click', () => {
      usingFrontCamera = !usingFrontCamera;
      if (isCameraOn) startCamera();
    });
    document.getElementById('60fpsBtn').addEventListener('click', () => {
      prefer60fps = !prefer60fps;
      document.getElementById('60fpsBtn').classList.toggle('btn-primary', prefer60fps);
      document.getElementById('60fpsBtn').classList.toggle('btn-secondary', !prefer60fps);
      if (isCameraOn) startCamera();
    });
    document.getElementById('resolutionSelect').addEventListener('change', () => {
      if (isCameraOn) startCamera();
    });

    // Initialize
    startCamera();
  </script>
</body>
</html>