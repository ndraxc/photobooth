<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rekam & Zoom Kamera</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      padding: 20px;
    }

    video {
      max-width: 100%;
      border-radius: 10px;
    }

    input[type="range"] {
      width: 300px;
    }

    button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      background-color: #3498db;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #2980b9;
    }
  </style>
</head>
<body>
  <h2>Rekam Video & Zoom Kamera</h2>
  <video id="preview" autoplay muted></video>
  <div>
    <label>Zoom:</label>
    <input type="range" id="zoomControl" min="1" max="3" step="0.01" value="1">
  </div>
  <div>
    <button id="startBtn">Mulai Rekam</button>
    <button id="stopBtn">Stop</button>
    <a id="downloadLink" style="display:none;" download="rekaman.webm">Download Rekaman</a>
  </div>
  <video id="recordedVideo" controls style="display:none;"></video>

  <script>
    let mediaRecorder;
    let recordedBlobs = [];
    let videoTrack;
    let stream;

    const preview = document.getElementById('preview');
    const recordedVideo = document.getElementById('recordedVideo');
    const zoomControl = document.getElementById('zoomControl');
    const downloadLink = document.getElementById('downloadLink');

    async function startCamera() {
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: { zoom: true }, audio: true });
        preview.srcObject = stream;

        // Ambil track video untuk kontrol zoom
        videoTrack = stream.getVideoTracks()[0];
        const capabilities = videoTrack.getCapabilities();

        if (capabilities.zoom) {
          zoomControl.min = capabilities.zoom.min;
          zoomControl.max = capabilities.zoom.max;
          zoomControl.step = capabilities.zoom.step || 0.01;
          zoomControl.value = videoTrack.getSettings().zoom || 1;

          zoomControl.addEventListener('input', () => {
            const zoomValue = parseFloat(zoomControl.value);
            videoTrack.applyConstraints({ advanced: [{ zoom: zoomValue }] });
          });
        } else {
          zoomControl.disabled = true;
        }

        mediaRecorder = new MediaRecorder(stream);

        mediaRecorder.ondataavailable = (e) => {
          if (e.data.size > 0) recordedBlobs.push(e.data);
        };

        mediaRecorder.onstop = () => {
          const blob = new Blob(recordedBlobs, { type: 'video/webm' });
          const url = URL.createObjectURL(blob);
          recordedVideo.src = url;
          recordedVideo.style.display = 'block';
          downloadLink.href = url;
          downloadLink.style.display = 'inline';
        };
      } catch (err) {
        alert('Gagal mengakses kamera: ' + err.message);
        console.error(err);
      }
    }

    document.getElementById('startBtn').onclick = () => {
      recordedBlobs = [];
      mediaRecorder.start();
    };

    document.getElementById('stopBtn').onclick = () => {
      mediaRecorder.stop();
    };

    startCamera();
  </script>
</body>
</html>